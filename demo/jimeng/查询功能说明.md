# å³æ¢¦è§†é¢‘æŸ¥è¯¢åŠŸèƒ½è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

å³æ¢¦è§†é¢‘ API æä¾›è§†é¢‘æŸ¥è¯¢åŠŸèƒ½ï¼Œç”¨äºæ£€æŸ¥è§†é¢‘ç”Ÿæˆçš„è¿›åº¦å’ŒçŠ¶æ€ã€‚

## ğŸ” æŸ¥è¯¢æ¥å£

### åŸºæœ¬ç”¨æ³•

```python
from jimeng import JimengClient

client = JimengClient(api_token="your-token")

# æŸ¥è¯¢è§†é¢‘çŠ¶æ€
response = client.query_video("jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45")
status = response["data"]["status"]
```

### API ç«¯ç‚¹

- **Endpoint**: `GET https://yunwu.ai/v1/video/query`
- **å‚æ•°**: `id` - è§†é¢‘ IDï¼ˆæ¥è‡ª generate_video å“åº”ï¼‰
- **è®¤è¯**: Bearer Token

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET "https://yunwu.ai/v1/video/query?id=jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45" \
  -H "Accept: application/json" \
  -H "Authorization: Bearer your-token"
```

## ğŸ“Š å“åº”æ ¼å¼

### å¤„ç†ä¸­ (Processing)

```json
{
  "id": "jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45",
  "status": "processing",
  "progress": 45,
  "created_at": "2025-12-30T10:00:00Z",
  "updated_at": "2025-12-30T10:05:00Z"
}
```

### å®Œæˆ (Completed)

```json
{
  "id": "jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45",
  "status": "completed",
  "progress": 100,
  "video_url": "https://example.com/video.mp4",
  "created_at": "2025-12-30T10:00:00Z",
  "completed_at": "2025-12-30T10:15:00Z"
}
```

### å¤±è´¥ (Failed)

```json
{
  "id": "jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45",
  "status": "failed",
  "progress": 0,
  "error": "Invalid prompt",
  "created_at": "2025-12-30T10:00:00Z",
  "failed_at": "2025-12-30T10:01:00Z"
}
```

## ğŸ“Š çŠ¶æ€å€¼

| çŠ¶æ€ | è¯´æ˜ | å«ä¹‰ |
|------|------|------|
| `processing` | å¤„ç†ä¸­ | è§†é¢‘æ­£åœ¨ç”Ÿæˆ |
| `completed` | å®Œæˆ | è§†é¢‘ç”Ÿæˆå®Œæˆï¼Œå¯ä¸‹è½½ |
| `failed` | å¤±è´¥ | è§†é¢‘ç”Ÿæˆå¤±è´¥ |

## ğŸ¯ æŸ¥è¯¢ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç®€å•æŸ¥è¯¢

```python
from jimeng import JimengClient

client = JimengClient(api_token="your-token")

# æŸ¥è¯¢å•ä¸ªè§†é¢‘
response = client.query_video("jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45")

if response["status_code"] == 200:
    data = response["data"]
    print(f"Status: {data['status']}")
    print(f"Progress: {data.get('progress', 0)}%")

    if data["status"] == "completed":
        print(f"Video URL: {data['video_url']}")
```

### ç¤ºä¾‹ 2: ç­‰å¾…å®Œæˆ

```python
from jimeng import JimengClient, wait_for_video_completion

client = JimengClient(api_token="your-token")

video_id = "jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45"

try:
    result = wait_for_video_completion(
        client,
        video_id,
        timeout=600,      # ç­‰å¾…æœ€å¤š 10 åˆ†é’Ÿ
        poll_interval=10   # æ¯ 10 ç§’æ£€æŸ¥ä¸€æ¬¡
    )
    print(f"âœ“ è§†é¢‘å®Œæˆ: {result['data']['video_url']}")
except TimeoutError:
    print("âœ— è¶…æ—¶ï¼šè§†é¢‘ç”Ÿæˆè€—æ—¶è¿‡é•¿")
except Exception as e:
    print(f"âœ— é”™è¯¯: {e}")
```

### ç¤ºä¾‹ 3: æ‰¹é‡æŸ¥è¯¢

```python
from jimeng import JimengClient

client = JimengClient(api_token="your-token")

video_ids = [
    "jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45",
    "jimeng:a1b2c3d4-e5f6-47g8-h9i0-j1k2l3m4n5o6",
    "jimeng:x7y8z9a0-b1c2-43d4-e5f6-g7h8i9j0k1l2"
]

results = {
    "completed": [],
    "processing": [],
    "failed": []
}

for video_id in video_ids:
    response = client.query_video(video_id)
    status = response["data"]["status"]

    if status == "completed":
        results["completed"].append({
            "id": video_id,
            "url": response["data"]["video_url"]
        })
    elif status == "processing":
        results["processing"].append(video_id)
    elif status == "failed":
        results["failed"].append(video_id)

print(f"å®Œæˆ: {len(results['completed'])}")
print(f"å¤„ç†ä¸­: {len(results['processing'])}")
print(f"å¤±è´¥: {len(results['failed'])}")
```

### ç¤ºä¾‹ 4: è‡ªå®šä¹‰è¶…æ—¶

```python
from jimeng import JimengClient, wait_for_video_completion

client = JimengClient(api_token="your-token")
video_id = "jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45"

# å¿«é€Ÿæ£€æŸ¥ (30 ç§’)
try:
    result = wait_for_video_completion(
        client,
        video_id,
        timeout=30,
        poll_interval=5
    )
except TimeoutError:
    print("è§†é¢‘è¿˜æœªå®Œæˆ")

# æ ‡å‡†ç­‰å¾… (10 åˆ†é’Ÿ)
result = wait_for_video_completion(
    client,
    video_id,
    timeout=600,
    poll_interval=10
)

# é•¿æ—¶é—´ç­‰å¾… (30 åˆ†é’Ÿ)
result = wait_for_video_completion(
    client,
    video_id,
    timeout=1800,
    poll_interval=30
)
```

## â±ï¸ è¶…æ—¶é…ç½®

### æ¨èé…ç½®

| ç”¨é€” | timeout | poll_interval | è¯´æ˜ |
|------|---------|---------------|------|
| å¿«é€Ÿæ£€æŸ¥ | 30 ç§’ | 5 ç§’ | å¿«é€Ÿç¡®è®¤æ˜¯å¦å®Œæˆ |
| æ ‡å‡†ç­‰å¾… | 600 ç§’ (10 åˆ†é’Ÿ) | 10 ç§’ | å¤§å¤šæ•°è§†é¢‘ç”Ÿæˆæ—¶é—´ |
| é•¿æ—¶é—´ç­‰å¾… | 1800 ç§’ (30 åˆ†é’Ÿ) | 30 ç§’ | é•¿è§†é¢‘æˆ–ç½‘ç»œæ…¢ |

### è‡ªå®šä¹‰è¶…æ—¶

```python
# ç­‰å¾…æœ€å¤š 5 åˆ†é’Ÿ
result = wait_for_video_completion(
    client,
    video_id,
    timeout=300,
    poll_interval=10
)
```

## ğŸ”„ çŠ¶æ€æµè½¬

```
generate_video (åˆ›å»ºè¯·æ±‚)
       â†“
processing (å¤„ç†ä¸­)
       â†“
    â•­â”€â”€â”´â”€â”€â•®
    â†“     â†“
completed failed
(å®Œæˆ)   (å¤±è´¥)
```

## ğŸ“ˆ è¿›åº¦è¿½è¸ª

```python
from jimeng import JimengClient

client = JimengClient(api_token="your-token")
video_id = "jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45"

import time

while True:
    response = client.query_video(video_id)
    data = response["data"]
    status = data["status"]
    progress = data.get("progress", 0)

    print(f"\rProgress: {progress}%", end="")

    if status == "completed":
        print(f"\nâœ“ å®Œæˆ!")
        print(f"URL: {data['video_url']}")
        break
    elif status == "failed":
        print(f"\nâœ— å¤±è´¥!")
        print(f"Error: {data.get('error', 'Unknown')}")
        break

    time.sleep(10)
```

## ğŸ§ª è¿è¡Œç¤ºä¾‹

### æŸ¥è¯¢ç¤ºä¾‹

```bash
python3 -m jimeng.query_examples
```

### é¢„æœŸè¾“å‡º

```
================================================================================
Jimeng Video Query Examples
================================================================================

IMPORTANT: These are dry-run examples.
Actual API calls are commented out to avoid costs.

--- Example 1: Simple Query ---
Querying video status...
Video ID: jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45
Query URL: https://yunwu.ai/v1/video/query?id=jimeng:7391ad0e-9813-48ba-a742-ed0720e44e45

--- Example 2: Multiple Queries ---
Querying multiple videos...
...
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ€»æ˜¯éªŒè¯å“åº”çŠ¶æ€ç 

```python
response = client.query_video(video_id)
if response["status_code"] != 200:
    print(f"API é”™è¯¯: {response['status_code']}")
    return
```

### 2. æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€

```python
status = response["data"]["status"]
if status == "completed":
    # å¤„ç†å®Œæˆ
elif status == "processing":
    # ä»åœ¨å¤„ç†
elif status == "failed":
    # å¤„ç†å¤±è´¥
else:
    # æœªçŸ¥çŠ¶æ€
```

### 3. å¤„ç†è¶…æ—¶å¼‚å¸¸

```python
try:
    result = wait_for_video_completion(client, video_id)
except TimeoutError:
    print("ç”Ÿæˆè¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•")
except Exception as e:
    print(f"é”™è¯¯: {e}")
```

### 4. è®°å½•æŸ¥è¯¢å†å²

```python
import logging

logging.info(f"Querying: {video_id}")
response = client.query_video(video_id)
logging.info(f"Status: {response['data']['status']}")
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¸è¦ç¡¬ç¼–ç  Token**
   ```python
   import os
   token = os.getenv("JIMENG_API_TOKEN")
   client = JimengClient(api_token=token)
   ```

2. **éªŒè¯ Video ID æ ¼å¼**
   ```python
   if not video_id.startswith("jimeng:"):
       raise ValueError("Invalid video ID format")
   ```

3. **è®°å½•æ‰€æœ‰æŸ¥è¯¢**
   ```python
   logging.debug(f"Query: {video_id}")
   response = client.query_video(video_id)
   logging.debug(f"Response: {response}")
   ```

## ğŸ› å¸¸è§é—®é¢˜

### Q: è§†é¢‘ ID ä»å“ªé‡Œè·å–ï¼Ÿ
A: ä» `generate_video()` çš„å“åº”ä¸­è·å–ï¼š
```python
response = client.generate_video(request)
video_id = response["data"]["id"]
```

### Q: è¶…æ—¶åèƒ½ç»§ç»­æŸ¥è¯¢å—ï¼Ÿ
A: å¯ä»¥ï¼Œä½¿ç”¨ç›¸åŒçš„ video_id æŸ¥è¯¢ï¼š
```python
response = client.query_video(video_id)
```

### Q: å¦‚ä½•æŸ¥è¯¢å·²å®Œæˆçš„è§†é¢‘ï¼Ÿ
A: ä½¿ç”¨ä»»ä½•æ—¶é—´ç‚¹çš„ video_id æŸ¥è¯¢ï¼š
```python
# 24 å°æ—¶åä»å¯æŸ¥è¯¢
response = client.query_video(video_id)
if response["data"]["status"] == "completed":
    url = response["data"]["video_url"]
```

### Q: é”™è¯¯çŠ¶æ€è¡¨ç¤ºä»€ä¹ˆï¼Ÿ
A: è¡¨ç¤ºè§†é¢‘ç”Ÿæˆå¤±è´¥ï¼Œé”™è¯¯åŸå› åœ¨ `error` å­—æ®µï¼š
```python
if status == "failed":
    error = data.get("error", "Unknown error")
    print(f"å¤±è´¥åŸå› : {error}")
```

## ğŸ“š ç›¸å…³åŠŸèƒ½

- [`generate_video()`](README.md#ç”Ÿæˆè§†é¢‘) - åˆ›å»ºè§†é¢‘ç”Ÿæˆè¯·æ±‚
- [`wait_for_video_completion()`](#ç­‰å¾…å®Œæˆ) - ç­‰å¾…è§†é¢‘å®Œæˆ
- [`create_simple_video_request()`](README.md#ç®€å•æ–‡ç”Ÿè§†é¢‘) - åˆ›å»ºè¯·æ±‚

## ğŸ‰ æ€»ç»“

âœ… å®Œæ•´çš„æŸ¥è¯¢æ¥å£<br>
âœ… çŠ¶æ€æŒç»­è¿½è¸ª<br>
âœ… è¶…æ—¶å’Œé”™è¯¯å¤„ç†<br>
âœ… æ‰¹é‡æŸ¥è¯¢æ”¯æŒ<br>
âœ… è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹

ç°åœ¨å¯ä»¥å®‰å…¨åœ°æŸ¥è¯¢å’Œè¿½è¸ªè§†é¢‘ç”Ÿæˆè¿›åº¦äº†ï¼
