# Kling API æŸ¥è¯¢åŠŸèƒ½è¯´æ˜

## ğŸ“ æ–°å¢åŠŸèƒ½

**æ›´æ–°æ—¥æœŸ**: 2025-12-30

å·²æ·»åŠ è§†é¢‘ç”ŸæˆçŠ¶æ€æŸ¥è¯¢åŠŸèƒ½ï¼Œæ”¯æŒï¼š
- å•ä¸ªä»»åŠ¡æŸ¥è¯¢
- æ‰¹é‡ä»»åŠ¡æŸ¥è¯¢
- è‡ªåŠ¨è½®è¯¢ç­‰å¾…
- è‡ªå®šä¹‰è½®è¯¢é€»è¾‘

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. query_video() - æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```python
from kling import KlingClient

client = KlingClient(api_token="your-token")

# æŸ¥è¯¢ä»»åŠ¡
response = client.query_video("827297867001249878")

print(f"çŠ¶æ€: {response['data']['status']}")
```

**è¿”å›æ ¼å¼**:
```python
{
    "status_code": 200,
    "data": {
        "task_id": "827297867001249878",
        "status": "completed",  # processing, completed, failed
        "progress": 100,
        "video_url": "https://...",
        "thumbnail_url": "https://...",
        "duration": "5",
        "created_at": "2025-12-30T12:00:00Z",
        "completed_at": "2025-12-30T12:05:00Z"
    }
}
```

### 2. wait_for_video_completion() - è‡ªåŠ¨ç­‰å¾…å®Œæˆ

```python
from kling import wait_for_video_completion

# ç”Ÿæˆè§†é¢‘
response = client.generate_video(request)
task_id = response["data"]["task_id"]

# è‡ªåŠ¨è½®è¯¢ç›´åˆ°å®Œæˆ
result = wait_for_video_completion(
    client,
    task_id,
    max_wait_seconds=300,  # æœ€å¤šç­‰å¾…5åˆ†é’Ÿ
    poll_interval=10       # æ¯10ç§’æŸ¥è¯¢ä¸€æ¬¡
)

print(f"è§†é¢‘URL: {result['data']['video_url']}")
```

**ç‰¹ç‚¹**:
- è‡ªåŠ¨è½®è¯¢
- è¶…æ—¶æ§åˆ¶
- é”™è¯¯å¤„ç†
- è¿›åº¦è·Ÿè¸ª

## ğŸ“š ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: ç”Ÿæˆåç«‹å³æŸ¥è¯¢

```python
# 1. ç”Ÿæˆè§†é¢‘
request = create_simple_video_request(
    model_name="kling-v2-6",
    image_url="https://example.com/image.jpg",
    prompt="ç¾ä¸½çš„æ—¥è½",
    duration="5"
)

response = client.generate_video(request)
task_id = response["data"]["task_id"]

# 2. æŸ¥è¯¢çŠ¶æ€
result = client.query_video(task_id)
print(f"å½“å‰çŠ¶æ€: {result['data']['status']}")
```

### åœºæ™¯ 2: è½®è¯¢ç›´åˆ°å®Œæˆ

```python
import time

task_id = "your-task-id"

while True:
    response = client.query_video(task_id)
    status = response["data"]["status"]

    if status == "completed":
        print(f"å®Œæˆ: {response['data']['video_url']}")
        break
    elif status == "failed":
        print(f"å¤±è´¥: {response['data']['error']}")
        break
    else:
        print(f"å¤„ç†ä¸­... {response['data'].get('progress', 0)}%")
        time.sleep(10)
```

### åœºæ™¯ 3: æ‰¹é‡æŸ¥è¯¢

```python
task_ids = ["task-1", "task-2", "task-3"]

for task_id in task_ids:
    response = client.query_video(task_id)
    status = response["data"]["status"]
    print(f"{task_id}: {status}")
```

### åœºæ™¯ 4: ä½¿ç”¨è‡ªåŠ¨ç­‰å¾…

```python
# æœ€ç®€å•çš„æ–¹å¼
result = wait_for_video_completion(client, task_id)
video_url = result["data"]["video_url"]
print(f"è§†é¢‘å·²ç”Ÿæˆ: {video_url}")
```

## ğŸ” çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | è¯´æ˜ | ä¸‹ä¸€æ­¥ |
|------|------|--------|
| `processing` | æ­£åœ¨ç”Ÿæˆ | ç»§ç»­è½®è¯¢ |
| `completed` | å·²å®Œæˆ | è·å–è§†é¢‘URL |
| `failed` | å¤±è´¥ | æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ |
| `pending` | ç­‰å¾…ä¸­ | ç»§ç»­è½®è¯¢ |
| `queued` | æ’é˜Ÿä¸­ | ç»§ç»­è½®è¯¢ |

## ğŸ“Š å“åº”å­—æ®µ

### æˆåŠŸå“åº”
```python
{
    "status_code": 200,
    "data": {
        "task_id": str,           # ä»»åŠ¡ID
        "status": str,            # çŠ¶æ€
        "progress": int,          # è¿›åº¦ 0-100
        "video_url": str,         # è§†é¢‘URLï¼ˆå®Œæˆæ—¶ï¼‰
        "thumbnail_url": str,     # ç¼©ç•¥å›¾URL
        "duration": str,          # æ—¶é•¿
        "created_at": str,        # åˆ›å»ºæ—¶é—´
        "completed_at": str,      # å®Œæˆæ—¶é—´
        "model_name": str,        # ä½¿ç”¨çš„æ¨¡å‹
        "image": str              # æºå›¾ç‰‡URL
    }
}
```

### å¤±è´¥å“åº”
```python
{
    "status_code": 200,
    "data": {
        "task_id": str,
        "status": "failed",
        "error": str,             # é”™è¯¯ä¿¡æ¯
        "error_code": str         # é”™è¯¯ä»£ç 
    }
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åˆç†è®¾ç½®è½®è¯¢é—´éš”

```python
# çŸ­è§†é¢‘ï¼ˆ5ç§’ï¼‰
poll_interval = 10  # æ¯10ç§’æŸ¥è¯¢

# é•¿è§†é¢‘ï¼ˆ10ç§’+ï¼‰
poll_interval = 20  # æ¯20ç§’æŸ¥è¯¢
```

### 2. è®¾ç½®è¶…æ—¶æ—¶é—´

```python
# æ ¹æ®è§†é¢‘æ—¶é•¿è®¾ç½®
duration = 5  # ç§’
max_wait = duration * 60  # 5åˆ†é’Ÿ

result = wait_for_video_completion(
    client,
    task_id,
    max_wait_seconds=max_wait
)
```

### 3. é”™è¯¯å¤„ç†

```python
try:
    result = wait_for_video_completion(client, task_id)
    video_url = result["data"]["video_url"]
except TimeoutError:
    print("ç”Ÿæˆè¶…æ—¶ï¼Œè¯·ç¨åæŸ¥è¯¢")
except Exception as e:
    print(f"ç”Ÿæˆå¤±è´¥: {e}")
```

### 4. è¿›åº¦æ˜¾ç¤º

```python
import time

while True:
    response = client.query_video(task_id)
    status = response["data"]["status"]
    progress = response["data"].get("progress", 0)

    # æ˜¾ç¤ºè¿›åº¦æ¡
    bar = "=" * (progress // 2)
    print(f"\r[{bar:<50}] {progress}%", end="")

    if status in ["completed", "failed"]:
        print()  # æ¢è¡Œ
        break

    time.sleep(5)
```

## ğŸ§ª æµ‹è¯•

### è¿è¡ŒæŸ¥è¯¢ç¤ºä¾‹

```bash
python3 -m kling.query_examples
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
--- Example 1: Simple Query ---
Status Code: 200
Response: {'task_id': '...', 'status': 'completed'}

Task Status: completed
Video URL: https://...
```

## ğŸ“ å®Œæ•´å·¥ä½œæµç¨‹

```python
from kling import (
    KlingClient,
    create_simple_video_request,
    wait_for_video_completion
)

# 1. åˆå§‹åŒ–å®¢æˆ·ç«¯
client = KlingClient(api_token="your-token")

# 2. åˆ›å»ºè¯·æ±‚
request = create_simple_video_request(
    model_name="kling-v2-6",
    image_url="https://example.com/image.jpg",
    prompt="ç¾ä¸½çš„æ—¥è½åœºæ™¯",
    duration="5"
)

# 3. ç”Ÿæˆè§†é¢‘
print("å¼€å§‹ç”Ÿæˆè§†é¢‘...")
response = client.generate_video(request)
task_id = response["data"]["task_id"]
print(f"ä»»åŠ¡ID: {task_id}")

# 4. ç­‰å¾…å®Œæˆ
print("ç­‰å¾…ç”Ÿæˆå®Œæˆ...")
try:
    result = wait_for_video_completion(
        client,
        task_id,
        max_wait_seconds=300,
        poll_interval=10
    )

    # 5. è·å–ç»“æœ
    video_url = result["data"]["video_url"]
    print(f"âœ“ è§†é¢‘å·²ç”Ÿæˆ: {video_url}")

except TimeoutError:
    print("âœ— ç”Ÿæˆè¶…æ—¶")
except Exception as e:
    print(f"âœ— ç”Ÿæˆå¤±è´¥: {e}")
```

## ğŸ”§ API ç«¯ç‚¹

- **ç”Ÿæˆè§†é¢‘**: `POST /kling/v1/videos/image2video`
- **æŸ¥è¯¢çŠ¶æ€**: `GET /kling/v1/videos/image2video/{task_id}`

## ğŸ“¦ æ–°å¢æ–‡ä»¶

1. **kling_client.py** - æ·»åŠ  `query_video()` æ–¹æ³•
2. **kling_client.py** - æ·»åŠ  `wait_for_video_completion()` å‡½æ•°
3. **query_examples.py** - æŸ¥è¯¢ç¤ºä¾‹ä»£ç 
4. **ä½¿ç”¨è¯´æ˜.md** - æ›´æ–°æ·»åŠ æŸ¥è¯¢éƒ¨åˆ†

## âœ… åŠŸèƒ½æ¸…å•

- âœ… å•ä¸ªä»»åŠ¡æŸ¥è¯¢
- âœ… æ‰¹é‡ä»»åŠ¡æŸ¥è¯¢
- âœ… è‡ªåŠ¨è½®è¯¢ç­‰å¾…
- âœ… è¶…æ—¶æ§åˆ¶
- âœ… é”™è¯¯å¤„ç†
- âœ… è¿›åº¦è·Ÿè¸ª
- âœ… å®Œæ•´ç¤ºä¾‹
- âœ… æ–‡æ¡£æ›´æ–°

## ğŸ‰ æ€»ç»“

ç°åœ¨ Kling API æ¨¡å—æ”¯æŒå®Œæ•´çš„è§†é¢‘ç”Ÿæˆå·¥ä½œæµï¼š

1. **ç”Ÿæˆ** - `generate_video()`
2. **æŸ¥è¯¢** - `query_video()`
3. **ç­‰å¾…** - `wait_for_video_completion()`

å¯ä»¥è½»æ¾å®ç°ä»å›¾ç‰‡åˆ°è§†é¢‘çš„å®Œæ•´æµç¨‹ï¼
