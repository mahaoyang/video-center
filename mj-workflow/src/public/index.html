<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MJ Workflow Studio | Neural Orchestration</title>

  <!-- Google Fonts: Inter & JetBrains Mono -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap"
    rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    window.tailwind = window.tailwind || {};
    window.tailwind.config = {
      theme: {
        extend: {
          colors: {
            'studio-bg': '#08090a',
            'studio-panel': '#111214',
            'studio-border': '#1d1f23',
            'studio-accent': '#c5f341',
            'studio-text': '#e1e2e4',
          },
          fontFamily: {
            'sans': ['Inter', 'sans-serif'],
            'mono': ['JetBrains Mono', 'monospace'],
          },
        },
      },
    };
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    :root {
      --accent: #c5f341;
      --bg: #08090a;
    }

    html,
    body {
      height: 100%;
      overflow: hidden;
    }

    body {
      background-color: var(--bg);
      color: #e1e2e4;
      font-feature-settings: "ss01", "ss02", "cv01";
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    .shimmer-text {
      background: linear-gradient(90deg, #555, #fff, #555);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 4s infinite linear;
    }

    @keyframes shimmer {
      0% {
        background-position: -200% 0;
      }

      100% {
        background-position: 200% 0;
      }
    }

    .studio-panel {
      background: #111214;
      border: 1px solid #1d1f23;
      border-radius: 1.5rem;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .studio-panel:hover {
      border-color: #2d2f35;
      box-shadow: 0 20px 40px -20px rgba(0, 0, 0, 0.5);
    }

    .step-section {
      opacity: 0.15;
      filter: grayscale(1);
      transition: all 0.8s ease;
      pointer-events: none;
    }

    .step-section.active {
      opacity: 1;
      filter: grayscale(0);
      pointer-events: auto;
    }

    .input-studio {
      background: transparent;
      border: none;
      outline: none;
      width: 100%;
      color: white;
      font-size: 1.125rem;
    }

    /* Custom Buttons */
    .btn-studio {
      border-radius: 0.75rem;
      padding: 0.75rem 1.5rem;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-studio-primary {
      background: var(--accent);
      color: black;
    }

    .btn-studio-primary:hover:not(:disabled) {
      transform: scale(1.02);
      box-shadow: 0 0 30px rgba(197, 243, 65, 0.3);
    }

    .btn-studio-outline {
      border: 1px solid #2d2f35;
      color: #888;
    }

    .btn-studio-outline:hover {
      border-color: #555;
      color: white;
      background: rgba(255, 255, 255, 0.05);
    }

    @keyframes fade-in {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes fade-in-up {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pop-in {
      from {
        opacity: 0;
        transform: scale(0.9);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .animate-fade-in {
      animation: fade-in 0.8s ease forwards;
    }

    .animate-fade-in-up {
      animation: fade-in-up 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    .animate-pop-in {
      animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }

    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .glass-panel {
      background: rgba(17, 18, 20, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }
  </style>
</head>

<body class="selection:bg-studio-accent selection:text-black">

  <!-- PURE-STREAM WORKSPACE -->
  <div class="min-h-[100dvh] h-[100dvh] flex flex-col items-center bg-studio-bg overflow-hidden relative">
    <!-- BACKGROUND LAYERS -->
    <div class="pointer-events-none absolute inset-0 overflow-hidden">
      <div class="absolute -top-56 left-1/2 -translate-x-1/2 w-[980px] h-[980px] rounded-full bg-studio-accent/10 blur-[140px]"></div>
      <div class="absolute -bottom-64 -right-64 w-[900px] h-[900px] rounded-full bg-white/5 blur-[160px]"></div>
      <div class="absolute inset-0 opacity-[0.06]" style="background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.28) 1px, transparent 0); background-size: 36px 36px;"></div>
    </div>

    <!-- THE INFINITE CANVAS -->
    <main id="productionStream"
      class="relative flex-1 w-full max-w-5xl overflow-y-auto px-8 pt-20 pb-64 flex flex-col gap-24 scroll-smooth scrollbar-hide">
      <!-- INITIAL WELCOME -->
      <div id="zeroState"
        class="absolute inset-0 flex flex-col items-center justify-center text-center space-y-8 animate-fade-in pointer-events-none">
        <div class="text-[60px] font-black tracking-tighter opacity-10 leading-tight select-none uppercase">
          Neural<br />Flow</div>
        <p class="text-[10px] font-black uppercase tracking-[0.6em] opacity-20">Direct Protocol Layer 9 // Ready</p>
      </div>
    </main>

    <!-- PENDING STATE (The Neural Pulse) -->
    <div id="streamPending" class="hidden fixed bottom-44 left-1/2 -translate-x-1/2 z-[110] animate-fade-in">
      <div
        class="glass-panel px-10 py-5 rounded-full border border-studio-accent/20 flex items-center gap-5 shadow-2xl bg-studio-bg/60 backdrop-blur-xl">
        <div class="relative w-5 h-5">
          <div class="absolute inset-0 border-2 border-studio-accent/20 rounded-full"></div>
          <div class="absolute inset-0 border-2 border-studio-accent border-t-transparent rounded-full animate-spin">
          </div>
        </div>
        <div class="flex flex-col">
          <span id="progressText" class="text-sm font-black text-studio-accent leading-none">0%</span>
          <span class="text-[8px] font-black uppercase tracking-widest opacity-40 mt-1">Collecting Latent Samples</span>
        </div>
      </div>
    </div>

    <!-- FLOATING COMMAND CENTER (Premium Studio Input) -->
    <div id="commandHub"
      class="fixed bottom-12 left-1/2 -translate-x-1/2 w-full max-w-5xl px-8 z-[100] transition-all duration-700">

      <!-- REFERENCE TRAY -->
      <div id="referenceTray"
        class="group mb-4 flex items-center overflow-x-auto overflow-y-visible pb-4 pt-4 scrollbar-hide px-2">
        <!-- Thumbnails injected here -->
      </div>

      <div
        class="glass-panel p-2.5 rounded-[2.5rem] border border-white/5 shadow-3xl bg-studio-panel/80 backdrop-blur-3xl">
        <div class="flex items-end gap-3 p-1">
          <div id="uploadTrigger"
            class="relative w-14 h-14 flex items-center justify-center rounded-[1.8rem] bg-white/5 hover:bg-studio-accent hover:text-studio-bg cursor-pointer transition-all duration-300 group">
            <i class="fas fa-paperclip text-xs group-hover:rotate-12 transition-transform"></i>
            <input type="file" id="imageUpload"
              class="absolute inset-0 z-10 opacity-0 cursor-pointer"
              multiple accept="image/*" />
            <button type="button" id="padMatrixBtn"
              class="absolute -bottom-1 -right-1 z-20 px-2 py-1 rounded-full bg-black/60 border border-white/10 text-[7px] font-black uppercase tracking-widest text-white/70 hover:text-studio-accent hover:border-studio-accent/30 transition-all">
              Pad <span id="padCount" class="ml-1 text-studio-accent">0</span>
            </button>
          </div>
          <div class="relative flex-1">
            <textarea id="promptInput"
              class="w-full bg-transparent border-none focus:ring-0 p-4 text-sm placeholder:opacity-20 resize-none min-h-[56px] max-h-48 leading-relaxed font-medium"
              placeholder="Command the Neural Engine..."></textarea>
            <div id="promptBeautifySpinner" class="hidden absolute right-4 top-4 w-5 h-5 pointer-events-none">
              <div class="absolute inset-0 border-2 border-studio-accent/25 rounded-full"></div>
              <div class="absolute inset-0 border-2 border-studio-accent border-t-transparent rounded-full animate-spin"></div>
            </div>
          </div>
          <div class="relative">
            <button id="commandModeBtn" type="button"
              class="w-14 h-14 flex items-center justify-center rounded-[1.8rem] bg-white/5 border border-white/10 text-white/70 hover:text-studio-accent hover:border-studio-accent/40 hover:bg-white/10 transition-all">
              <i class="fas fa-layer-group text-xs"></i>
            </button>
            <div id="commandModeMenu"
              class="hidden absolute right-0 bottom-full mb-3 w-[260px] rounded-[1.8rem] bg-black/85 border border-white/10 backdrop-blur-xl shadow-2xl overflow-hidden">
              <div class="px-4 pt-4 pb-2 text-[9px] font-black uppercase tracking-[0.25em] opacity-50">Mode</div>
              <button type="button" data-command-mode="mj"
                class="w-full px-4 py-3 text-left text-[12px] hover:bg-white/5 transition-all flex items-center justify-between">
                <span class="font-medium">MJ 生图</span>
                <span class="text-[10px] font-mono opacity-40">Image</span>
              </button>
              <button type="button" data-command-mode="video"
                class="w-full px-4 py-3 text-left text-[12px] hover:bg-white/5 transition-all flex items-center justify-between">
                <span class="font-medium">生视频</span>
                <span class="text-[10px] font-mono opacity-40">Video</span>
              </button>
              <button type="button" data-command-mode="deconstruct"
                class="w-full px-4 py-3 text-left text-[12px] hover:bg-white/5 transition-all flex items-center justify-between">
                <span class="font-medium">反推提示词（Gemini）</span>
                <span class="text-[10px] font-mono opacity-40">Describe</span>
              </button>
              <button type="button" data-command-mode="pedit"
                class="w-full px-4 py-3 text-left text-[12px] hover:bg-white/5 transition-all flex items-center justify-between">
                <span class="font-medium">图片 P‑Edit（Gemini）</span>
                <span class="text-[10px] font-mono opacity-40">Edit</span>
              </button>
              <button type="button" data-command-mode="beautify"
                class="w-full px-4 py-3 text-left text-[12px] hover:bg-white/5 transition-all flex items-center justify-between">
                <span class="font-medium">提示词美化（Gemini）</span>
                <span class="text-[10px] font-mono opacity-40">Polish</span>
              </button>
              <div class="px-4 py-3 text-[9px] font-mono opacity-35 border-t border-white/10">
                提示：小飞机会执行当前模式
              </div>
            </div>
          </div>
          <div class="relative group">
            <button id="step3Next" type="button"
              class="w-14 h-14 flex items-center justify-center rounded-[1.8rem] bg-studio-accent text-studio-bg hover:scale-105 active:scale-95 transition-all shadow-[0_0_25px_rgba(197,243,65,0.25)]">
              <i class="fas fa-paper-plane text-xs"></i>
            </button>
            <div
              class="pointer-events-none absolute right-0 -top-2 -translate-y-full opacity-0 group-hover:opacity-100 transition-opacity">
              <div class="px-3 py-2 rounded-2xl bg-black/70 border border-white/10 text-[9px] font-black uppercase tracking-[0.25em] text-white/70 whitespace-nowrap">Execute</div>
            </div>
          </div>
        </div>

        <!-- P-EDIT PANEL -->
        <div id="pEditPanel" class="hidden px-3 pb-3 animate-fade-in">
          <div class="mt-2 rounded-[2rem] border border-white/10 bg-white/[0.02] p-5">
            <div class="flex items-center justify-between gap-4">
              <div class="flex items-center gap-3">
                <div class="w-9 h-9 rounded-2xl bg-studio-accent/10 border border-studio-accent/20 flex items-center justify-center">
                  <i class="fas fa-wand-magic-sparkles text-[10px] text-studio-accent"></i>
                </div>
                <div class="flex flex-col">
                  <span class="text-[9px] font-black uppercase tracking-[0.3em] opacity-60">Gemini P‑Edit</span>
                  <span id="pEditMeta" class="text-[9px] font-mono opacity-40">使用主输入框文字作为 P 图指令</span>
                </div>
              </div>
              <button id="pEditClose" type="button"
                class="w-9 h-9 rounded-2xl bg-white/5 border border-white/10 hover:border-white/20 hover:text-white transition-all flex items-center justify-center text-white/60">
                <i class="fas fa-times text-[10px]"></i>
              </button>
            </div>

            <div class="mt-4 flex items-start gap-4">
              <div class="relative w-16 h-16 rounded-2xl overflow-hidden border border-white/10 bg-black/30 flex-shrink-0">
                <img id="pEditThumb" class="w-full h-full object-cover" referrerpolicy="no-referrer" />
              </div>
              <div class="flex-1 text-[10px] font-mono opacity-40 leading-relaxed pt-2">
                在主输入框里写 P 图指令（例如“把背景改成日落海边，增加电影感光晕，保持主体不变”），然后点 Apply。
              </div>
            </div>

            <div class="mt-4 flex justify-end">
              <button id="pEditApply" type="button"
                class="px-5 py-3 rounded-2xl bg-studio-accent text-studio-bg font-black text-[9px] uppercase tracking-widest hover:scale-[1.02] active:scale-[0.98] transition-all">
                <i class="fas fa-wand-magic-sparkles text-[10px]"></i><span class="ml-2">Apply</span>
              </button>
            </div>
          </div>
        </div>

        <!-- COMMAND EXTRA PANEL (Mode-specific) -->
        <div id="commandExtraPanel" class="hidden px-3 pb-3 animate-fade-in">
          <div class="mt-2 rounded-[2rem] border border-white/10 bg-white/[0.02] p-5">
            <div id="commandBeautifyPanel" class="hidden">
              <div class="flex items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                  <div class="w-9 h-9 rounded-2xl bg-studio-accent/10 border border-studio-accent/20 flex items-center justify-center">
                    <i class="fas fa-pen-nib text-[10px] text-studio-accent"></i>
                  </div>
                  <div class="flex flex-col">
                    <span class="text-[9px] font-black uppercase tracking-[0.3em] opacity-60">Prompt Beautify</span>
                    <span class="text-[9px] font-mono opacity-40">仅美化提示词主体，不改参数</span>
                  </div>
                </div>
              </div>
              <div class="mt-4">
                <input id="commandBeautifyHint" type="text"
                  class="w-full bg-white/5 border border-white/10 rounded-2xl px-4 py-3 text-[12px] font-medium focus:border-studio-accent/50 transition-all"
                  placeholder="美化建议 / 方向（可选）" />
              </div>
            </div>

            <div id="commandVideoPanel" class="hidden">
              <div class="flex items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                  <div class="w-9 h-9 rounded-2xl bg-studio-accent/10 border border-studio-accent/20 flex items-center justify-center">
                    <i class="fas fa-film text-[10px] text-studio-accent"></i>
                  </div>
                  <div class="flex flex-col">
                    <span class="text-[9px] font-black uppercase tracking-[0.3em] opacity-60">Video Generate</span>
                    <span class="text-[9px] font-mono opacity-40">注意：生视频成本很高，请确认参数</span>
                  </div>
                </div>
              </div>

              <div class="mt-5 grid grid-cols-2 gap-4">
                <div class="relative">
                  <div class="text-[9px] font-black uppercase tracking-widest opacity-40 mb-2">Provider</div>
                  <button id="videoProviderBtn" type="button"
                    class="w-full px-4 py-3 rounded-2xl bg-white/5 border border-white/10 text-left text-[12px] hover:border-studio-accent/40 transition-all flex items-center justify-between">
                    <span id="videoProviderLabel" class="font-medium">Jimeng</span>
                    <i class="fas fa-chevron-down text-[10px] opacity-50"></i>
                  </button>
                  <div id="videoProviderMenu"
                    class="hidden absolute left-0 right-0 bottom-full mb-2 rounded-2xl bg-black/85 border border-white/10 backdrop-blur-xl shadow-2xl overflow-hidden">
                    <button type="button" data-video-provider="jimeng"
                      class="w-full px-4 py-3 text-left text-[12px] hover:bg-white/5 transition-all">Jimeng</button>
                    <button type="button" data-video-provider="kling"
                      class="w-full px-4 py-3 text-left text-[12px] hover:bg-white/5 transition-all">Kling</button>
                    <button type="button" data-video-provider="gemini"
                      class="w-full px-4 py-3 text-left text-[12px] hover:bg-white/5 transition-all">Gemini（自定义模型）</button>
                  </div>
                </div>

                <div class="relative">
                  <div class="text-[9px] font-black uppercase tracking-widest opacity-40 mb-2">Model</div>
                  <input id="videoModelInput" type="text"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-4 py-3 text-[12px] font-medium focus:border-studio-accent/50 transition-all"
                    placeholder="jimeng-video-3.0 / kling-v2-6 / gemini-video-..." />
                </div>
              </div>

              <div class="mt-4 grid grid-cols-4 gap-4">
                <div>
                  <div class="text-[9px] font-black uppercase tracking-widest opacity-40 mb-2">Seconds</div>
                  <input id="videoSecondsInput" type="number" min="1" max="60" step="1"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-4 py-3 text-[12px] font-medium focus:border-studio-accent/50 transition-all"
                    placeholder="可选" />
                </div>
                <div>
                  <div class="text-[9px] font-black uppercase tracking-widest opacity-40 mb-2">Mode</div>
                  <input id="videoModeInput" type="text"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-4 py-3 text-[12px] font-medium focus:border-studio-accent/50 transition-all"
                    placeholder="kling: std / pro（可选）" />
                </div>
                <div>
                  <div class="text-[9px] font-black uppercase tracking-widest opacity-40 mb-2">Aspect</div>
                  <input id="videoAspectInput" type="text"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-4 py-3 text-[12px] font-medium focus:border-studio-accent/50 transition-all"
                    placeholder="16:9 / 9:16 / 1:1（可选）" />
                </div>
                <div>
                  <div class="text-[9px] font-black uppercase tracking-widest opacity-40 mb-2">Size</div>
                  <input id="videoSizeInput" type="text"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-4 py-3 text-[12px] font-medium focus:border-studio-accent/50 transition-all"
                    placeholder="1080P / 720P / large（可选）" />
                </div>
              </div>

              <div class="mt-4 grid grid-cols-2 gap-4">
                <div class="relative">
                  <div class="text-[9px] font-black uppercase tracking-widest opacity-40 mb-2">Start Frame (optional)</div>
                  <button id="videoStartRefBtn" type="button"
                    class="w-full px-4 py-3 rounded-2xl bg-white/5 border border-white/10 text-left text-[12px] hover:border-studio-accent/40 transition-all flex items-center justify-between">
                    <span id="videoStartRefLabel" class="font-medium">（无）</span>
                    <i class="fas fa-chevron-down text-[10px] opacity-50"></i>
                  </button>
                  <div id="videoStartRefMenu"
                    class="hidden absolute left-0 right-0 bottom-full mb-2 max-h-72 overflow-auto rounded-2xl bg-black/85 border border-white/10 backdrop-blur-xl shadow-2xl"></div>
                </div>
                <div class="relative">
                  <div class="text-[9px] font-black uppercase tracking-widest opacity-40 mb-2">End Frame (optional)</div>
                  <button id="videoEndRefBtn" type="button"
                    class="w-full px-4 py-3 rounded-2xl bg-white/5 border border-white/10 text-left text-[12px] hover:border-studio-accent/40 transition-all flex items-center justify-between">
                    <span id="videoEndRefLabel" class="font-medium">（无）</span>
                    <i class="fas fa-chevron-down text-[10px] opacity-50"></i>
                  </button>
                  <div id="videoEndRefMenu"
                    class="hidden absolute left-0 right-0 bottom-full mb-2 max-h-72 overflow-auto rounded-2xl bg-black/85 border border-white/10 backdrop-blur-xl shadow-2xl"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex items-center gap-8 px-6 py-2.5 border-t border-white/[0.03] mt-1 text-white">
          <!-- Aspect Ratio Console -->
          <div class="flex items-center gap-3">
            <span id="mjArCurrent" class="px-2 py-1 rounded-lg bg-white/5 border border-white/10 text-[9px] font-mono opacity-50 mr-2 tracking-widest">--ar 1:1</span>
            <div class="flex bg-white/5 rounded-lg overflow-hidden border border-white/5">
              <button data-ar="1:1"
                class="mj-ar-btn px-3 py-1.5 hover:bg-studio-accent hover:text-studio-bg transition-all text-[8px] font-black border-r border-white/5">1:1</button>
              <button data-ar="16:9"
                class="mj-ar-btn px-3 py-1.5 hover:bg-studio-accent hover:text-studio-bg transition-all text-[8px] font-black border-r border-white/5">16:9</button>
              <button data-ar="9:16"
                class="mj-ar-btn px-3 py-1.5 hover:bg-studio-accent hover:text-studio-bg transition-all text-[8px] font-black border-r border-white/5">9:16</button>
              <button data-ar="2:3"
                class="mj-ar-btn px-3 py-1.5 hover:bg-studio-accent hover:text-studio-bg transition-all text-[8px] font-black border-r border-white/5">2:3</button>
              <button id="mjClearArBtn"
                class="px-2 py-1.5 hover:bg-red-500 hover:text-white transition-all text-[8px] font-black"><i
                  class="fas fa-times"></i></button>
            </div>
          </div>

          <div class="w-px h-4 bg-white/5 hidden md:block"></div>

          <!-- Analysis Console -->
          <div class="flex items-center gap-8">
            <div class="flex items-center gap-2 opacity-30 hover:opacity-100 transition-all group">
              <i
                class="fas fa-brain text-[10px] opacity-30 group-hover:text-studio-accent group-hover:opacity-100 transition-all"></i>
              <span class="text-[8px] font-black uppercase tracking-[0.2em] text-white/30 group-hover:text-white transition-all">Gemini</span>
              <select id="describeEngineSelect" class="hidden">
                <option value="gemini" selected>Gemini Pro</option>
              </select>
            </div>

            <div id="deconstructTrigger"
              class="flex items-center gap-2 opacity-30 hover:opacity-100 cursor-pointer transition-all group text-white">
              <i class="fas fa-fingerprint text-[10px] group-hover:text-studio-accent"></i>
              <span class="text-[8px] font-black uppercase tracking-[0.2em]">Deconstruct</span>
            </div>
          </div>

          <div id="matrixOpenTrigger"
            class="flex items-center gap-2 opacity-30 hover:opacity-100 cursor-pointer transition-all group">
            <i class="fas fa-sliders-h text-[10px] group-hover:text-studio-accent"></i>
            <span class="text-[8px] font-black uppercase tracking-[0.2em]">Matrix</span>
          </div>

          <div id="plannerOpenTrigger"
            class="flex items-center gap-2 opacity-30 hover:opacity-100 cursor-pointer transition-all group">
            <i class="fas fa-comments text-[10px] group-hover:text-studio-accent"></i>
            <span class="text-[8px] font-black uppercase tracking-[0.2em]">Planner</span>
          </div>

          <div id="vaultOpenTrigger"
            class="flex items-center gap-2 opacity-30 hover:opacity-100 cursor-pointer transition-all ml-auto group">
            <i class="fas fa-folder-open text-[10px] group-hover:text-studio-accent"></i>
            <span class="text-[8px] font-black uppercase tracking-[0.2em]">Vault</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- THE PRODUCTION VAULT (Slide-over Overlay) -->
  <div id="historyOverlay" class="fixed inset-0 z-[200] pointer-events-none group">
    <div id="historyBackdrop"
      class="absolute inset-0 bg-black/60 backdrop-blur-md opacity-0 transition-opacity duration-700"></div>
    <div id="historyPanel"
      class="absolute right-0 top-0 bottom-0 w-full max-w-2xl bg-studio-panel border-l border-white/5 translate-x-full transition-transform duration-700 ease-in-out p-12 overflow-y-auto">
      <div class="flex items-center justify-between mb-16">
        <div class="flex items-center gap-4">
          <div class="w-2 h-2 bg-studio-accent rounded-full shadow-[0_0_10px_var(--studio-accent)]"></div>
          <span class="text-[12px] font-black uppercase tracking-[0.4em]">Integrated Archive</span>
          <span class="px-2 py-1 rounded-lg bg-white/5 text-[8px] font-mono opacity-40">CHAT <span
              id="conversationCount">0</span></span>
        </div>
        <div class="flex items-center gap-2">
          <button id="saveConversationBtn" type="button"
            class="btn-studio btn-studio-outline !px-4 !py-2 !text-[8px] !rounded-xl hover:text-white">
            Save Chat
          </button>
          <button id="clearConversationBtn" type="button"
            class="btn-studio btn-studio-outline !px-4 !py-2 !text-[8px] !rounded-xl hover:text-white hover:border-red-500/30 hover:text-red-400">
            Clear Chat
          </button>
          <button id="vaultCloseBtn" type="button"
            class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-white/5 transition-all">
            <i class="fas fa-times text-xs opacity-30"></i>
          </button>
        </div>
      </div>
      <div id="historyList" class="flex flex-col gap-4"></div>
      <div
        class="mt-40 pt-10 border-t border-white/5 opacity-20 text-[8px] font-black uppercase tracking-[0.3em] text-center">
        End of Neural Record</div>
    </div>
  </div>

  <!-- THE MATRIX OVERLAY (Parameters) -->
  <div id="matrixOverlay" class="fixed inset-0 z-[200] pointer-events-none group">
    <div id="matrixBackdrop"
      class="absolute inset-0 bg-black/60 backdrop-blur-md opacity-0 transition-opacity duration-700"></div>
    <div id="matrixPanel"
      class="absolute right-0 top-0 bottom-0 w-full max-w-xl bg-studio-panel border-l border-white/5 translate-x-full transition-transform duration-700 ease-in-out p-12 overflow-y-auto">
      <div class="flex items-center justify-between mb-16">
        <div class="flex items-center gap-4">
          <i class="fas fa-sliders-h text-studio-accent text-xs"></i>
          <span class="text-[12px] font-black uppercase tracking-[0.4em]">Matrix Parameters</span>
        </div>
        <button id="matrixCloseBtn" type="button"
          class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-white/5 transition-all">
          <i class="fas fa-times text-xs opacity-30"></i>
        </button>
      </div>

      <div class="space-y-12">
        <div class="space-y-4">
          <label class="text-[9px] font-black uppercase tracking-widest opacity-30">Active Param Chips</label>
          <div id="mjDetectedParams" class="flex flex-wrap gap-3 min-h-[40px]">
            <!-- Chips injected here -->
          </div>
        </div>

        <div class="space-y-4 pt-10 border-t border-white/5">
          <div class="flex items-center justify-between gap-4">
            <label class="text-[9px] font-black uppercase tracking-widest opacity-30">MJ 包装器</label>
          </div>
          <div id="mjPromptPreview"
            class="w-full min-h-[140px] max-h-[40vh] overflow-auto bg-white/[0.02] border border-white/10 rounded-2xl p-5 text-[11px] font-mono leading-relaxed whitespace-pre-wrap break-words select-none"></div>
          <div id="mjWrapperStats" class="text-[9px] font-mono opacity-40 leading-relaxed"></div>
          <div class="text-[9px] opacity-30 leading-relaxed">
            说明：PAD 图、SREF/CREF 在“生成”时会按需补全公网 URL（惰性上传到 CDN）；平时预览优先走本地 <code>/uploads</code>。
          </div>
        </div>

        <div class="space-y-4 pt-10 border-t border-white/5">
          <div class="flex items-center justify-between gap-4">
            <label class="text-[9px] font-black uppercase tracking-widest opacity-30">参考图选择（PAD / SREF / CREF）</label>
            <button id="clearRefsBtn" type="button"
              class="btn-studio btn-studio-outline !px-4 !py-2 !text-[8px] !rounded-xl hover:text-white">
              Clear Pad
            </button>
          </div>
          <div id="referenceList" class="grid grid-cols-4 gap-3"></div>
        </div>

        <div class="space-y-8 pt-12 border-t border-white/5 text-[10px] opacity-40 italic">
          More granular parameter controls coming in next firmware update. Use commands like --stylize or --chaos
          directly in prompt for now.
        </div>
      </div>
    </div>
  </div>

  <!-- THE PLANNER OVERLAY (Pure Chat Mode) -->
  <div id="plannerOverlay" class="fixed inset-0 z-[200] pointer-events-none group">
    <div id="plannerBackdrop"
      class="absolute inset-0 bg-black/60 backdrop-blur-md opacity-0 transition-opacity duration-700"></div>
    <div id="plannerPanel"
      class="absolute right-0 top-0 bottom-0 w-full max-w-2xl bg-studio-panel border-l border-white/5 translate-x-full transition-transform duration-700 ease-in-out p-10 overflow-hidden flex flex-col">
      <div class="flex items-center justify-between mb-8">
        <div class="flex items-center gap-4">
          <i class="fas fa-comments text-studio-accent text-xs"></i>
          <span class="text-[12px] font-black uppercase tracking-[0.4em]">Planner Chat</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="plannerClear" type="button"
            class="btn-studio btn-studio-outline !px-4 !py-2 !text-[8px] !rounded-xl hover:text-white hover:border-red-500/30 hover:text-red-300">
            Clear
          </button>
          <button id="plannerCloseBtn" type="button"
            class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-white/5 transition-all">
            <i class="fas fa-times text-xs opacity-30"></i>
          </button>
        </div>
      </div>

      <div id="plannerMessages" class="flex-1 overflow-y-auto pr-2 flex flex-col gap-4 scrollbar-hide"></div>

      <div class="mt-6 glass-panel p-2.5 rounded-[2.2rem] border border-white/5 bg-studio-panel/70">
        <div class="flex items-end gap-3 p-1">
          <textarea id="plannerInput"
            class="flex-1 bg-transparent border-none focus:ring-0 p-4 text-sm placeholder:opacity-20 resize-none min-h-[72px] max-h-[260px] leading-relaxed font-medium"
            placeholder="规划分镜/MJ 提示词，或输入 suno/歌词/配乐 让它把多分镜合成 1 首歌（Ctrl+Enter 发送）..."></textarea>
          <button id="plannerSend" type="button"
            class="w-14 h-14 flex items-center justify-center rounded-[1.8rem] bg-studio-accent text-studio-bg hover:scale-105 active:scale-95 transition-all shadow-[0_0_25px_rgba(197,243,65,0.25)]">
            <i class="fas fa-paper-plane text-xs"></i>
          </button>
        </div>
        <div class="px-5 pb-3 text-[9px] font-mono opacity-30">
          说明：MJ 模式会拆成多条分镜并可 “Use” 填入主输入框；Suno 模式会输出 LYRICS_PROMPT + STYLE_PROMPT，可一键复制。
        </div>
      </div>
    </div>
  </div>

  <!-- TINY HUD FOOTER -->
  <div
    class="fixed bottom-4 left-6 pointer-events-none opacity-20 text-[8px] font-black uppercase tracking-[0.4em] z-[50]">
    Studio Layer 9 // Enterprise Protocol
  </div>

  </div>

  <script type="module" src="/assets/app.js"></script>
</body>

</html>
